<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Gamo Home</title>
    <style>
        #userInfo { display: none; }
    </style>
</head>
<body>
<h1>로그인 성공!</h1>

<div id="loading">내 정보를 불러오는 중...</div>

<h2>내 정보</h2>
<div id="userInfo">
    <p><strong>ID:</strong> <span id="userId"></span></p>
    <p><strong>이름:</strong> <span id="userName"></span></p>
    <p><strong>이메일:</strong> <span id="userEmail"></span></p>
    <p><strong>이미지:</strong></p>
    <img id="userPicture" src="" alt="카톡 프사">
</div>

<script defer>
    window.addEventListener('load', async () => {
        const loadingEl = document.getElementById('loading');
        const infoEl = document.getElementById('userInfo');
        const imgEl = document.getElementById('userPicture');

        try {
            const res = await fetch('/api/member', {
                method: 'GET',
                credentials: 'include',
                headers: { 'Accept': 'application/json' }
            });

            if (res.status === 401) {
                // 로그인 안 된 경우 → 로그인 페이지로 보내기
                window.location.href = '/index.html';
                return;
            }

            if (!res.ok) {
                throw new Error(`HTTP ${res.status}`);
            }

            const data = await res.json();

            document.getElementById('userId').textContent = data.id ?? '';
            document.getElementById('userName').textContent = data.name ?? '';
            document.getElementById('userEmail').textContent = data.email ?? '';

            imgEl.src = data.picture;

            loadingEl.style.display = 'none';
            infoEl.style.display = 'block';
        } catch (err) {
            console.error(err);
            loadingEl.textContent = '사용자 정보를 불러오는 데 실패했습니다. 다시 로그인해주세요.';
        }
    });
</script>
</body>
</html>
